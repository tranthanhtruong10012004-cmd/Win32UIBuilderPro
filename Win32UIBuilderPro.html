<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Win32 UI Builder Pro v9.9 Zoom Studio</title>
<style>
:root {
  --accent:#0078D7;
  --border:#ccc;
  --text:#222;
  --bg:#f5f5f5;
  --panel:#fff;
  --control-bg:#fafafa;
  --radius:6px;
  --hover:#cce7ff;
}
body.dark {
  --bg:#121212;
  --panel:#1e1e1e;
  --text:#ffffff;
  --border:#333;
  --accent:#3794ff;
  --control-bg:#1a1a1a;
  --hover:#2d2d2d;
}
body.win11 {
  --bg:linear-gradient(135deg,#f5faff,#e8f0ff);
  --panel:rgba(255,255,255,0.85);
  backdrop-filter:blur(10px) saturate(160%);
  --radius:10px;
}
body.win10 {
  --bg:#f0f0f0;
  --panel:#fff;
  --radius:4px;
}
body {
  margin:0;
  font-family:"Segoe UI",sans-serif;
  background:var(--bg);
  color:var(--text);
  display:flex;
  flex-direction:column;
  height:100vh;
  overflow:hidden;
}

/* ===== Titlebar ===== */
#titlebar {
  background:var(--accent);
  color:#fff;
  padding:8px 16px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-weight:500;
  font-size:14px;
}

/* ===== Toolbar ===== */
#toolbar {
  background:var(--panel);
  border-bottom:1px solid var(--border);
  display:flex;
  flex-wrap:wrap;
  gap:6px;
  padding:6px 8px;
  align-items:center;
}
#toolbar button,
#toolbar select {
  padding:6px 10px;
  border:1px solid var(--border);
  background:var(--control-bg);
  cursor:pointer;
  border-radius:4px;
  font-size:13px;
  color:var(--text);
}
#toolbar button:hover {
  background:var(--accent);
  color:#fff;
}
#zoomContainer {
  margin-left:auto;
  display:flex;
  align-items:center;
  gap:6px;
}
#zoomSlider {
  width:120px;
}
#zoomValue {
  font-size:12px;
  width:40px;
  text-align:right;
}

/* ===== Workspace ===== */
#workspace {
  flex:1;
  display:flex;
  overflow:hidden;
}
#canvasWrapper {
  flex:1;
  overflow:scroll;
  background:var(--panel);
  cursor:grab;
  position:relative;
}
#canvas {
  position:absolute;
  width:8000px;
  height:8000px;
  background-size:10px 10px;
  background-image:
   linear-gradient(to right,var(--border)1px,transparent 1px),
   linear-gradient(to bottom,var(--border)1px,transparent 1px);
  transform-origin:0 0;
  transition:transform 0.1s ease-out;
}
.axis {
  position:absolute;
  background:red;
  z-index:1;
}
#axisX {
  height:1px;
  width:8000px;
  top:4000px;
  left:0;
}
#axisY {
  width:1px;
  height:8000px;
  left:4000px;
  top:0;
}

/* ===== Control Base ===== */
.control {
  position:absolute;
  border:1px solid var(--accent);
  background:var(--control-bg);
  color:var(--text);
  text-align:center;
  font-size:12px;
  border-radius:var(--radius);
  cursor:move;
  user-select:none;
  box-shadow:0 1px 2px rgba(0,0,0,.15);
  transition:background .15s,border .15s,box-shadow .15s;
}
.control.selected {
  box-shadow:0 0 8px var(--accent);
}
.control.locked {
  border:1px dotted var(--accent);
  cursor:not-allowed;
  opacity:.7;
}

/* ===== MainForm ===== */
.ctrl-MainForm {
  position: relative;
  border: 1px solid var(--border);
  background: linear-gradient(#ffffff, #eeeeee);
  border-radius: var(--radius);
  box-shadow: 0 2px 4px rgba(0,0,0,0.15);
  overflow: hidden;
}
.ctrl-MainForm .title {
  position: absolute;
  top: 0; left: 0; right: 70px;
  height: 28px;
  line-height: 28px;
  padding-left: 10px;
  font-weight: 500;
  background: #ffffff;
  color: #000;
  user-select: none;
  cursor: move;
  border-top-left-radius: var(--radius);
  border-top-right-radius: var(--radius);
}
body.dark .ctrl-MainForm .title {
  background: #222;
  color: #fff;
}
.ctrl-MainForm .win-btns {
  position: absolute;
  top: 0; right: 0;
  height: 28px;
  display: flex;
  align-items: center;
  gap: 2px;
  padding-right: 4px;
  z-index: 5;
}
.ctrl-MainForm .win-btn {
  width: 28px;
  height: 22px;
  text-align: center;
  line-height: 20px;
  border: none;
  background: transparent;
  color: #000;
  font-weight: bold;
  cursor: pointer;
  border-radius: 3px;
  transition: background .2s;
}
body.dark .ctrl-MainForm .win-btn { color:#fff; }
.ctrl-MainForm .win-btn:hover {
  background: #e3bbbb;
}
.ctrl-MainForm .win-btn.close:hover {
  background: #e81123;
  color: #fff;
}
.ctrl-MainForm .content {
  position: absolute;
  top: 28px; left: 0; right: 0; bottom: 0;
  background: var(--panel);
  color: var(--text);
  padding: 10px;
}

/* ===== Property Panel ===== */
#propertyPanel {
  width:280px;
  background:var(--panel);
  border-left:1px solid var(--border);
  padding:8px;
  overflow-y:auto;
}
#propertyPanel h3 {
  margin:0 0 8px;
  border-bottom:1px solid var(--border);
  padding-bottom:4px;
  color:var(--accent);
}
.property {margin-bottom:8px;}
.property label {
  font-size:12px;
  display:block;
  margin-bottom:3px;
}
.property input,
#propertyPanel select {
  width:100%;
  font-size:12px;
  padding:3px;
  border:1px solid var(--border);
  border-radius:3px;
  background:var(--control-bg);
  color:var(--text);
}
.property .row {
  display:flex;
  gap:6px;
  align-items:center;
}

/* ===== Style Popup ===== */
#stylePopup {
  position:absolute;
  z-index:100;
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:6px;
  padding:8px;
  width:230px;
  max-height:300px;
  overflow:auto;
  display:none;
  box-shadow:0 2px 8px rgba(0,0,0,.25);
}
#stylePopup h4 {
  margin:6px 0 4px;
  font-size:12px;
  border-bottom:1px solid var(--border);
}
#stylePopup label {
  font-size:12px;
  display:block;
  margin-bottom:2px;
}

/* ===== Output ===== */
#outputZone {
  background:#1e1e1e;
  color:#eee;
  font-family:Consolas,monospace;
  font-size:12px;
  border-top:1px solid #333;
  padding:8px;
  height:160px;
  overflow:auto;
  white-space:pre;
  position:relative;
}
#copyOutput {
  position:absolute;
  top:4px;
  right:8px;
  background:#0078D7;
  color:#fff;
  border:none;
  border-radius:4px;
  padding:3px 6px;
  font-size:11px;
  cursor:pointer;
}

/* ===== MenuBar ===== */
.ctrl-MenuBar {
  display:flex;
  align-items:center;
  background:transparent !important;
  border:none !important;
  border-radius:0;
  padding:0 4px;
  height:26px;
  user-select:none;
  overflow-x:auto;
  white-space:nowrap;
  box-shadow:none !important;
}
.ctrl-MenuBar .menu-tabs {
  display:flex;
  align-items:center;
  gap:6px;
  width:100%;
}
.menu-tab {
  background:transparent !important;
  border:none;
  outline:none;
  padding:3px 8px;
  border-radius:0;
  font-size:13px;
  cursor:pointer;
  color:#000;
  transition:color 0.2s;
}
body.dark .menu-tab { color:#fff; }
.menu-tab:hover {
  color:#0078D7;
  background:transparent !important;
}
.menu-add {
  background:transparent !important;
  color:#000;
  border:none;
  border-radius:0;
  width:22px;
  height:20px;
  text-align:center;
  line-height:18px;
  cursor:pointer;
  font-weight:bold;
  margin-left:6px;
  flex-shrink:0;
  transition:color 0.2s;
}
body.dark .menu-add { color:#fff; }
.menu-add:hover {
  color:#0078D7;
  background:transparent !important;
}
.progress-bar {
  background:#ddd;
  border-radius:4px;
  overflow:hidden;
}
.progress-inner {
  height:100%;
  background:linear-gradient(90deg,#4caf50,#2e7d32);
  transition:width 0.2s;
}

</style>
</head>
<body class="win11">
<div id="titlebar">
  <span>Win32 UI Builder Pro v9.9 Zoom Studio - By ChatGPT Tr·∫ßn Thanh Tr∆∞·ªùng</span>
  <button id="themeToggle">üåô Dark</button>
</div>

<div id="toolbar">
  <select id="controlSelect">
    <option value="">‚ûï Th√™m Control</option>
    <option>MainForm</option><option>MenuBar</option><option>Button</option>
    <option>Edit</option><option>Static</option><option>ComboBox</option>
    <option>ListBox</option><option>CheckBox</option><option>RadioButton</option>
    <option>GroupBox</option><option>TreeView</option><option>ListView</option>
    <option>ProgressBar</option><option>DateTimePicker</option>
    <option>TabControl</option><option>TabPage</option><option>SysLink</option>
    <option>CustomControl</option>
  </select>
  <button id="removeBtn">üóë X√≥a</button>
  <button id="undoBtn">üîÅ Undo</button>
  <button id="clearBtn">üßπ X√≥a t·∫•t c·∫£</button>
  <button id="lockBtn">üîí Kh√≥a to√†n b·ªô</button>
  <button id="saveBtn">üíæ L∆∞u layout</button>
  <button id="loadBtn">üìÇ N·∫°p layout</button>
  <button id="copyJSON">üìã Copy JSON</button>
  <select id="themeSelect">
    <option value="win11">ü™ü Win11</option>
    <option value="win10">ü™ü Win10</option>
  </select>
  <select id="exportSelect">
  <option value="cpp">üì§ Xu·∫•t Code C++</option>
  <option value="json">üìú Xu·∫•t Layout JSON</option>
  <option value="ts">üß© Xu·∫•t Code TypeScript</option>
  <option value="py">üêç Xu·∫•t Code Python (tkinter)</option>
</select>
  <button id="exportBtn">üì§ Xu·∫•t Code</button>
  <div id="zoomContainer">
    <label for="zoomSlider">üîç</label>
    <input id="zoomSlider" type="range" min="25" max="400" step="5" value="100">
    <span id="zoomValue">100%</span>
  </div>
</div>

<div id="workspace">
  <div id="canvasWrapper">
    <div id="canvas">
      <div id="axisX" class="axis"></div>
      <div id="axisY" class="axis"></div>
    </div>
  </div>

  <div id="propertyPanel">
    <h3>Thu·ªôc t√≠nh</h3>
    <div class="property">
      <label>üé® M√†u n·ªÅn:</label>
      <div class="row">
        <input type="color" id="colorPicker" value="#fafafa" style="flex:0 0 40px;height:28px;cursor:pointer;">
        <input type="text" id="colorInput" value="#fafafa" style="flex:1;">
      </div>
    </div>
    <div class="property">
      <label>üî† Font:</label>
      <select id="fontSelect">
        <option>Segoe UI</option><option>Roboto</option><option>Tahoma</option><option>Be Vietnam Pro</option>
      </select>
    </div>
    <div id="propertyContent">Ch·ªçn control ƒë·ªÉ ch·ªânh</div>
  </div>
</div>

<div id="outputZone">
  <button id="copyOutput">Copy</button>
// Code s·∫Ω hi·ªán ·ªü ƒë√¢y...
</div>
<script>
window.addEventListener("DOMContentLoaded", () => {
  // ======== BI·∫æN TO√ÄN C·ª§C ========
  const canvasWrapper = document.getElementById("canvasWrapper");
  const canvas = document.getElementById("canvas");
  const propertyContent = document.getElementById("propertyContent");
  const controlSelect = document.getElementById("controlSelect");
  const themeToggle = document.getElementById("themeToggle");
  const themeSelect = document.getElementById("themeSelect");
  const zoomSlider = document.getElementById("zoomSlider");
  const zoomValue = document.getElementById("zoomValue");

  const saveBtn = document.getElementById("saveBtn");
  const loadBtn = document.getElementById("loadBtn");
  const clearBtn = document.getElementById("clearBtn");
  const lockBtn = document.getElementById("lockBtn");
  const exportBtn = document.getElementById("exportBtn");
  const exportSelect = document.getElementById("exportSelect");
  const outputZone = document.getElementById("outputZone");

  const CENTER = 4000;
  let selected = null, isDragging = false, ox = 0, oy = 0;
  let lockedAll = false, zoomLevel = 100, currentMenu = "";
  const undoStack = [], MAX_UNDO = 20;
// üü† C·∫¢NH B√ÅO KHI F5 / RELOAD TRANG
window.addEventListener("beforeunload", (event) => {
  const hasControls = document.querySelectorAll(".control").length > 0;
  if (hasControls) {
    // Hi·ªán c·∫£nh b√°o t√πy tr√¨nh duy·ªát (Chrome, Edge, Firefox, v.v.)
    event.preventDefault();
    event.returnValue = "‚ö†Ô∏è B·∫°n ƒëang c√≥ d·ª± √°n ch∆∞a l∆∞u. R·ªùi kh·ªèi trang s·∫Ω m·∫•t to√†n b·ªô thay ƒë·ªïi.";
    return event.returnValue;
  }
});
  // ======== TI·ªÜN √çCH ========
  const scrollToCenter = () => {
    const wrapper = document.getElementById("canvasWrapper");
    wrapper.scrollLeft = (canvas.scrollWidth - wrapper.clientWidth) / 2;
    wrapper.scrollTop = (canvas.scrollHeight - wrapper.clientHeight) / 2;
  };

  const saveState = () => {
    undoStack.push(JSON.stringify(getLayout()));
    if (undoStack.length > MAX_UNDO) undoStack.shift();
  };

  const updateZoom = () => {
    canvas.style.transform = `scale(${zoomLevel / 100})`;
    zoomValue.textContent = `${zoomLevel}%`;
  };

  // ======== N√öT TOOLBAR ========
  saveBtn.onclick = () => {
    const blob = new Blob([JSON.stringify(getLayout(), null, 2)], { type: "application/json" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "layout_saved.json";
    a.click();
    alert("üíæ ƒê√£ l∆∞u layout th√†nh file JSON!");
  };

  loadBtn.onclick = () => {
    const inp = document.createElement("input");
    inp.type = "file";
    inp.accept = ".json";
    inp.onchange = (ev) => {
      const f = ev.target.files[0];
      if (!f) return;
      const r = new FileReader();
      r.onload = (rEvent) => {
        try { setLayout(JSON.parse(rEvent.target.result)); }
        catch (err) { alert("‚ùå L·ªói n·∫°p layout: " + err.message); }
      };
      r.readAsText(f);
    };
    inp.click();
  };

  clearBtn.onclick = () => {
    if (confirm("‚ö†Ô∏è X√≥a to√†n b·ªô control tr√™n canvas?")) {
      canvas.innerHTML = '<div id="axisX" class="axis"></div><div id="axisY" class="axis"></div>';
      saveState();
    }
  };

  lockBtn.onclick = () => {
    lockedAll = !lockedAll;
    document.querySelectorAll(".control").forEach(c => {
      c.classList.toggle("locked", lockedAll);
      c.style.pointerEvents = lockedAll ? "none" : "auto";
    });
    lockBtn.textContent = lockedAll ? "üîí Unlock" : "üîì Lock";
  };

  // ======== DARK/LIGHT + THEME ========
  themeToggle.onclick = () => {
    document.body.classList.toggle("dark");
    themeToggle.textContent = document.body.classList.contains("dark") ? "‚òÄÔ∏è Light" : "üåô Dark";
  };
  themeSelect.onchange = () => {
    document.body.classList.remove("win10", "win11");
    document.body.classList.add(themeSelect.value);
  };

  // ======== ZOOM ========
  zoomSlider.oninput = e => { zoomLevel = parseInt(e.target.value); updateZoom(); };
  canvasWrapper.addEventListener("wheel", e => {
    if (e.ctrlKey) {
      e.preventDefault();
      zoomLevel += e.deltaY < 0 ? 2 : -2;
      zoomLevel = Math.min(400, Math.max(25, zoomLevel));
      zoomSlider.value = zoomLevel;
      updateZoom();
    }
  }, { passive: false });

  // ======== TH√äM CONTROL ========
  controlSelect.onchange = e => {
    const type = e.target.value;
    if (!type) return;
    addControl(type);
    e.target.value = "";
  };

 function addControl(type, data = null) {
  let el;

  switch (type) {
    // ===== MENU BAR =====
    case "MenuBar":
      el = document.createElement("div");
      el.className = "control ctrl-MenuBar";
      const tabs = data?.tabs || ["File", "Edit", "View", "Help"];
      el.innerHTML = `<div class="menu-tabs">
        ${tabs.map(t => `<div class="menu-tab">${t}</div>`).join("")}
      </div>`;
      bindMenuTabs(el);
      break;

    // ===== BUTTON =====
    case "Button":
      el = document.createElement("button");
      el.className = "control ctrl-Button";
      el.textContent = data?.caption || "Button";
      break;

    // ===== EDIT (TEXTBOX) =====
    case "Edit":
      el = document.createElement("input");
      el.type = "text";
      el.className = "control ctrl-Edit";
      el.value = data?.caption || "";
      break;

    // ===== GROUPBOX =====
    case "GroupBox":
      el = document.createElement("fieldset");
      el.className = "control ctrl-GroupBox";
      el.innerHTML = `<legend>${data?.caption || "GroupBox"}</legend>`;
      break;

    // ===== CHECKBOX =====
    case "CheckBox":
      el = document.createElement("label");
      el.className = "control ctrl-CheckBox";
      el.style.background = "transparent";
      el.style.border = "none";
      el.style.boxShadow = "none";
      el.innerHTML = `<input type="checkbox"${data?.checked ? " checked" : ""} 
        style="accent-color:#0078d7;background:transparent;border:none;margin-right:4px;">
        <span style="background:transparent;">${data?.caption || "CheckBox"}</span>`;
      break;

    // ===== RADIO =====
    case "Radio":
      el = document.createElement("label");
      el.className = "control ctrl-Radio";
      el.style.background = "transparent";
      el.style.border = "none";
      el.style.boxShadow = "none";
      el.innerHTML = `<input type="radio" name="radioGroup"${data?.checked ? " checked" : ""} 
        style="accent-color:#0078d7;background:transparent;border:none;margin-right:4px;">
        <span style="background:transparent;">${data?.caption || "Radio"}</span>`;
      break;

    // ===== COMBOBOX =====
    case "ComboBox":
      el = document.createElement("select");
      el.className = "control ctrl-ComboBox";
      (data?.options || ["Option 1", "Option 2"]).forEach(opt => {
        const o = document.createElement("option");
        o.textContent = opt;
        el.appendChild(o);
      });
      break;

    // ===== LABEL / STATIC =====
    case "Label":
    case "Static":
      el = document.createElement("div");
      el.className = "control ctrl-Label";
      el.textContent = data?.caption || "Static";
      el.style.background = "transparent";
      el.style.border = "none";
      el.style.boxShadow = "none";
      el.style.cursor = "default";
      el.style.textAlign = "left";
      el.style.padding = "0 4px";
      el.style.fontSize = "12px";
      el.style.color = "#000";
      break;

    // ===== PROGRESSBAR =====
    case "ProgressBar":
      el = document.createElement("div");
      el.className = "control ctrl-ProgressBar";
      el.innerHTML = `<div class="bar" style="width:${data?.progress || 30}%"></div>`;
      break;

    default:
      el = document.createElement("div");
      el.className = "control";
      el.textContent = data?.caption || type;
  }

  // ===== DATASET =====
  el.dataset.type = type;
  el.dataset.caption = data?.caption || type;
  el.dataset.comment = data?.comment || "";
  el.dataset.part = data?.part || "";
  el.dataset.lock = data?.lock || "false";
  el.dataset.visible = data?.visible ?? "true";

  // ===== POSITION =====
  const x = data ? CENTER + (data.x || 0) : CENTER;
  const y = data ? CENTER + (data.y || 0) : CENTER;
  el.style.left = x + "px";
  el.style.top = y + "px";
  el.style.width = (data?.w || 120) + "px";
  el.style.height = (data?.h || 26) + "px";
  el.style.display = el.dataset.visible === "false" ? "none" : "block";

  // ===== APPEND CONTROL =====
  canvas.appendChild(el);
  makeDraggable(el);
  selectControl(el);
  saveState();
  return el;
}



// ======== MENU ·∫®N/HI·ªÜN ========
function bindMenuTabs(menuBar) {
  menuBar.querySelectorAll(".menu-tab").forEach(tab => {
    tab.addEventListener("click", () => {
      document.querySelectorAll(".menu-tab").forEach(t => t.classList.remove("active"));
      tab.classList.add("active");
      const menuName = tab.textContent.trim();
      currentMenu = menuName;
      showControlsByMenu(menuName);
	
    });
  });

  // Hi·ªÉn th·ªã m·∫∑c ƒë·ªãnh menu ƒë·∫ßu ti√™n (n·∫øu c√≥)
  const firstTab = menuBar.querySelector(".menu-tab");
  if (firstTab) {
    firstTab.classList.add("active");
    currentMenu = firstTab.textContent.trim();
    showControlsByMenu(currentMenu);
  }
}

function showControlsByMenu(menuName) {
  currentMenu = menuName.trim();
  console.log("üü© Menu ƒëang ch·ªçn:", currentMenu);

  document.querySelectorAll(".control").forEach(ctrl => {
    const type = ctrl.dataset.type || "";
    const part = (ctrl.dataset.part || "").trim(); // ‚ú® trim lu√¥n chu·ªói part
    const visible = ctrl.dataset.visible !== "false";

    // Lu√¥n hi·ªÉn th·ªã control n·ªÅn ho·∫∑c kh√¥ng thu·ªôc part
    if (type === "MainForm" || type === "MenuBar" || part === "") {
      ctrl.style.display = visible ? "block" : "none";
      return;
    }

    // ‚úÖ So s√°nh c√≥ normalize v√† trim hai b√™n
    const match = (part.localeCompare(currentMenu, undefined, { sensitivity: "base" }) === 0) && visible;
    ctrl.style.display = match ? "block" : "none";

    // Log debug chi ti·∫øt
    console.log(`${match ? "‚úÖ Hi·ªán" : "‚ùå ·∫®n"} control: ${ctrl.dataset.caption || ctrl.dataset.type} ‚Üí part: '${part}' / menuName: '${currentMenu}'`);
  });
}

  // ======== K√âO CONTROL ========
  function makeDraggable(el) {
    el.onmousedown = e => {
      if (e.button !== 0 || lockedAll) return;
      if (el.dataset.lock === "true") return;
      isDragging = true;
      ox = e.offsetX; oy = e.offsetY;
      selectControl(el);
    };
  }
  window.onmousemove = e => {
    if (isDragging && selected) {
      const rect = canvas.getBoundingClientRect();
      selected.style.left = e.clientX - rect.left - ox + "px";
      selected.style.top = e.clientY - rect.top - oy + "px";
      updateProperty(selected);
    }
  };
  window.onmouseup = () => { if (isDragging) { isDragging = false; saveState(); } };

  // ======== PROPERTY PANEL ========
  function selectControl(ctrl) {
    document.querySelectorAll(".control").forEach(c => c.classList.remove("selected"));
    ctrl.classList.add("selected");
    selected = ctrl;
    updateProperty(ctrl);
  }

  function updateProperty(ctrl) {
    const x = parseInt(ctrl.style.left) - CENTER;
    const y = parseInt(ctrl.style.top) - CENTER;
    const w = parseInt(ctrl.style.width) || 120;
    const h = parseInt(ctrl.style.height) || 30;
    const checkedLock = ctrl.dataset.lock === "true" ? "checked" : "";
    const checkedVis = ctrl.dataset.visible !== "false" ? "checked" : "";

    propertyContent.innerHTML = `
      <div class='property'><label>X:</label><input id='p_x' type='number' value='${x}'></div>
      <div class='property'><label>Y:</label><input id='p_y' type='number' value='${y}'></div>
      <div class='property'><label>R·ªông:</label><input id='p_w' type='number' value='${w}'></div>
      <div class='property'><label>Cao:</label><input id='p_h' type='number' value='${h}'></div>
      <div class='property'><label>Hi·ªÉn th·ªã:</label><input id='p_caption' type='text' value='${ctrl.dataset.caption || ""}'></div>
      <div class='property'><label>Ph·∫ßn/Menu:</label><input id='p_part' type='text' value='${ctrl.dataset.part || ""}'></div>

      <div class='property flex-row'>
        <label for='p_visible' style='display:flex;align-items:center;gap:6px;'>
          üëÅ Hi·ªÉn th·ªã
          <input type='checkbox' id='p_visible' ${checkedVis} style='transform:scale(1.1);margin-left:6px;'>
        </label>
      </div>
      <div class='property flex-row'>
        <label for='p_lock' style='display:flex;align-items:center;gap:6px;'>
          üîí Kh√≥a ri√™ng
          <input type='checkbox' id='p_lock' ${checkedLock} style='transform:scale(1.1);margin-left:6px;'>
        </label>
      </div>
    `;

    ["x","y","w","h"].forEach(k=>{
      document.getElementById("p_"+k).oninput=e=>{
        const v=parseInt(e.target.value)||0;
        if(k==="x")ctrl.style.left=(CENTER+v)+"px";
        if(k==="y")ctrl.style.top=(CENTER+v)+"px";
        if(k==="w")ctrl.style.width=v+"px";
        if(k==="h")ctrl.style.height=v+"px";
      };
    });
    document.getElementById("p_caption").oninput=e=>{
      ctrl.dataset.caption=e.target.value;
      if(ctrl.tagName==="BUTTON"||ctrl.tagName==="DIV") ctrl.textContent=e.target.value;
    };
    document.getElementById("p_part").oninput=e=>ctrl.dataset.part=e.target.value;
    document.getElementById("p_visible").onchange=e=>{
      ctrl.dataset.visible=e.target.checked?"true":"false";
      ctrl.style.display=e.target.checked?"block":"none";
      saveState();
    };
    document.getElementById("p_lock").onchange=e=>{
      ctrl.dataset.lock=e.target.checked?"true":"false";
      ctrl.classList.toggle("locked",e.target.checked);
    };
  }

  // ======== EXPORT ========
  exportBtn.onclick = () => {
    const type = exportSelect.value;
    const layout = getLayout();
    let out = "";

    if (type === "json") out = JSON.stringify(layout, null, 2);
    else if (type === "cpp") {
      out = "// Win32 UI Builder Export\n#include <windows.h>\nvoid CreateUI(HWND hwnd,HINSTANCE hInst){\n";
      out += "HFONT hFont=(HFONT)GetStockObject(DEFAULT_GUI_FONT);\n";
      layout.forEach((c,i)=>{
        if(c.type==="MenuBar"){out+=`HMENU hMenu=CreateMenu();\n`; if(c.tabs)c.tabs.forEach(t=>out+=`AppendMenu(hMenu,MF_STRING,0,L"${t}");\n`); out+="SetMenu(hwnd,hMenu);\n";return;}
        out+=`HWND h${c.type}${i}=CreateWindowW(L"${c.type}",L"${c.caption}",WS_CHILD|WS_VISIBLE,${c.x},${c.y},${c.w},${c.h},hwnd,(HMENU)${1000+i},hInst,NULL);\n`;
        if(c.visible==="false") out+=`ShowWindow(h${c.type}${i},SW_HIDE);\n`;
      });
      out+="}\n";
    }

    outputZone.textContent = out;
    navigator.clipboard.writeText(out);
    alert(`‚úÖ ƒê√£ xu·∫•t & copy code ${type.toUpperCase()}!`);
  };

  // ======== LAYOUT ========
  const getLayout = () => [...document.querySelectorAll(".control")].map(c=>{
    const tabs=c.classList.contains("ctrl-MenuBar")?[...c.querySelectorAll(".menu-tab")].map(t=>t.textContent.trim()):undefined;
    return{
      type:c.dataset.type,caption:c.dataset.caption,comment:c.dataset.comment,part:c.dataset.part,
      lock:c.dataset.lock,visible:c.dataset.visible,tabs,
      x:parseInt(c.style.left)-CENTER,y:parseInt(c.style.top)-CENTER,
      w:parseInt(c.style.width),h:parseInt(c.style.height)
    };
  });

  const setLayout = data => {
    canvas.innerHTML='<div id="axisX" class="axis"></div><div id="axisY" class="axis"></div>';
    data.forEach(d=>addControl(d.type,d));
    scrollToCenter();
    const menuBar=document.querySelector(".ctrl-MenuBar");
	document.querySelector(".menu-tab")?.click();
    if(menuBar) bindMenuTabs(menuBar);
  };

  // ======== KH·ªûI T·∫†O ========
  scrollToCenter();
  updateZoom();
});
</script>

</body>
</html>
