<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Win32 UI Builder Pro v6 Live</title>
<style>
/* ========== üåà TO√ÄN B·ªò GIAO DI·ªÜN LIGHT/DARK ========== */
:root {
  --bg-color: #f5f5f5;
  --text-color: #222;
  --border-color: #ccc;
  --accent: #0078D7;
  --panel-bg: #ffffff;
  --code-bg: #fafafa;
}
body.dark {
  --bg-color: #1e1e1e;
  --text-color: #f5f5f5;
  --border-color: #555;
  --accent: #3794ff;
  --panel-bg: #252526;
  --code-bg: #1e1e1e;
}
body {
  margin: 0;
  font-family: "Segoe UI", sans-serif;
  background: var(--bg-color);
  color: var(--text-color);
  height: 100vh;
  display: flex;
  flex-direction: column;
}

/* ========== ü™ü THANH TITLE ========== */
#titlebar {
  background: var(--accent);
  color: #fff;
  padding: 8px 16px;
  font-weight: 600;
  user-select: none;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
#titlebar span {
  font-size: 14px;
}
#themeToggle {
  cursor: pointer;
  background: rgba(255,255,255,0.2);
  padding: 4px 10px;
  border-radius: 6px;
  transition: background 0.2s;
}
#themeToggle:hover {
  background: rgba(255,255,255,0.35);
}

/* ========== üß∞ TOOLBAR ========== */
#toolbar {
  background: var(--panel-bg);
  border-bottom: 1px solid var(--border-color);
  display: flex;
  gap: 6px;
  padding: 6px 8px;
  align-items: center;
  flex-wrap: wrap;
}
#toolbar button, #toolbar select {
  padding: 6px 10px;
  font-size: 13px;
  border: 1px solid var(--border-color);
  background: var(--code-bg);
  cursor: pointer;
  border-radius: 4px;
  transition: background 0.2s;
}
#toolbar button:hover {
  background: var(--accent);
  color: #fff;
}
#toolbar select {
  font-size: 13px;
}

/* ========== üìê KHU V·ª∞C CANVAS CH√çNH ========== */
#workspace {
  flex: 1;
  display: flex;
  overflow: hidden;
}
#canvas {
  position: relative;
  flex: 1;
  background: repeating-linear-gradient(0deg, var(--panel-bg), var(--panel-bg) 7px, var(--border-color) 8px),
              repeating-linear-gradient(90deg, var(--panel-bg), var(--panel-bg) 7px, var(--border-color) 8px);
  overflow: auto;
  border-right: 1px solid var(--border-color);
}

/* ========== üìã PROPERTY PANEL ========== */
#propertyPanel {
  width: 260px;
  background: var(--panel-bg);
  border-left: 1px solid var(--border-color);
  padding: 8px;
  overflow-y: auto;
}
#propertyPanel h3 {
  margin-top: 0;
  font-size: 15px;
  border-bottom: 1px solid var(--border-color);
  padding-bottom: 4px;
}
.property {
  margin-bottom: 8px;
}
.property label {
  display: block;
  font-size: 12px;
  margin-bottom: 3px;
}
.property input, .property textarea, .property select {
  width: 100%;
  font-size: 12px;
  padding: 3px;
  border: 1px solid var(--border-color);
  border-radius: 3px;
  background: var(--code-bg);
  color: var(--text-color);
}

/* ========== ü™ü CONTROL TR√äN CANVAS ========== */
.control {
  position: absolute;
  border: 1px solid var(--accent);
  background: var(--panel-bg);
  color: var(--text-color);
  text-align: center;
  font-size: 12px;
  user-select: none;
  cursor: move;
  overflow: hidden;
  border-radius: 3px;
}
.control.locked {
  border-style: dotted;
  cursor: not-allowed;
  opacity: 0.7;
}

/* ========== üßæ CODE PREVIEW PANEL ========== */
#codePreview {
  background: var(--code-bg);
  color: var(--text-color);
  font-family: "Consolas", monospace;
  font-size: 12px;
  border-top: 1px solid var(--border-color);
  padding: 10px;
  height: 200px;
  overflow: auto;
  white-space: pre;
}

/* ========== ‚ö° POPUP ALERT COPY ========== */
#popup {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: var(--accent);
  color: #fff;
  padding: 8px 16px;
  border-radius: 6px;
  display: none;
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}
</style>
</head>
<body>

<!-- ü™ü Thanh ti√™u ƒë·ªÅ -->
<div id="titlebar">
  <span>Form1 ‚Äì Win32 UI Builder Pro v6</span>
  <div id="themeToggle">üåô Dark</div>
</div>

<!-- üß∞ Thanh c√¥ng c·ª• -->
<div id="toolbar">
  <select id="controlSelect">
    <option value="">‚ûï Th√™m Control</option>
    <option value="MainForm">MainForm (C·ª≠a s·ªï g·ªëc)</option>
    <option value="Button">Button (N√∫t b·∫•m)</option>
    <option value="Edit">Edit (√î nh·∫≠p)</option>
    <option value="Static">Static (Nh√£n)</option>
    <option value="ComboBox">ComboBox (Danh s√°ch th·∫£)</option>
    <option value="ListBox">ListBox (Danh s√°ch)</option>
    <option value="CheckBox">CheckBox</option>
    <option value="RadioButton">RadioButton</option>
    <option value="GroupBox">GroupBox</option>
    <option value="ProgressBar">ProgressBar</option>
    <option value="DateTimePicker">DateTimePicker</option>
    <option value="TabControl">TabControl</option>
    <option value="ListView">ListView</option>
    <option value="TreeView">TreeView</option>
    <option value="Toolbar">Toolbar</option>
    <option value="StatusBar">StatusBar</option>
    <option value="PictureBox">PictureBox</option>
    <option value="Trackbar">Trackbar (Slider)</option>
    <option value="UpDown">UpDown (Spin)</option>
    <option value="IPAddress">IPAddressCtrl</option>
    <option value="HotKeyCtrl">HotKeyCtrl</option>
    <option value="MonthCalendar">MonthCalendar</option>
    <option value="SysLink">SysLink</option>
    <option value="ScrollBar">ScrollBar</option>
    <option value="CustomControl">CustomControl</option>
  </select>

  <button id="removeBtn">üóë X√≥a</button>
  <button id="undoBtn">üîÅ Undo</button>
  <button id="clearBtn">üßπ X√≥a t·∫•t c·∫£</button>
  <button id="saveBtn">üíæ L∆∞u layout</button>
  <button id="loadBtn">üìÇ N·∫°p layout</button>
  <button id="exportBtn">üì§ Xu·∫•t code</button>
  <select id="langSelect">
    <option value="cpp">C++</option>
    <option value="c">C</option>
    <option value="json">JSON</option>
    <option value="python">Python GUI</option>
  </select>
</div>

<!-- üß± Khu v·ª±c l√†m vi·ªác ch√≠nh -->
<div id="workspace">
  <div id="canvas"></div>
  <div id="propertyPanel">
    <h3>Thu·ªôc t√≠nh</h3>
    <div id="propertyContent">Ch·ªçn 1 control ƒë·ªÉ ch·ªânh thu·ªôc t√≠nh</div>
  </div>
</div>

<!-- üßæ Khung xem code -->
<div id="codePreview">// Code C++ Win32 s·∫Ω xu·∫•t hi·ªán t·∫°i ƒë√¢y...</div>

<div id="popup">‚úÖ ƒê√£ sao ch√©p v√†o clipboard</div>
  <script>
// ==============================
// ‚öôÔ∏è C·∫§U H√åNH & BI·∫æN TO√ÄN C·ª§C
// ==============================
const canvas = document.getElementById("canvas");
const propertyContent = document.getElementById("propertyContent");
const controlSelect = document.getElementById("controlSelect");
const themeToggle = document.getElementById("themeToggle");
const popup = document.getElementById("popup");
const undoStack = [];
let selectedControl = null;
let isDragging = false;
let offsetX = 0, offsetY = 0;
let isLockedAll = false;
const MAX_UNDO = 3;

// ==============================
// üåô DARK/LIGHT MODE
// ==============================
themeToggle.addEventListener("click", () => {
  document.body.classList.toggle("dark");
  const isDark = document.body.classList.contains("dark");
  themeToggle.textContent = isDark ? "‚òÄÔ∏è Light" : "üåô Dark";
  localStorage.setItem("ui_theme", isDark ? "dark" : "light");
});

window.addEventListener("load", () => {
  if (localStorage.getItem("ui_theme") === "dark") {
    document.body.classList.add("dark");
    themeToggle.textContent = "‚òÄÔ∏è Light";
  }
});

// ==============================
// ‚ûï TH√äM CONTROL V√ÄO FORM
// ==============================
controlSelect.addEventListener("change", () => {
  const type = controlSelect.value;
  if (!type) return;
  addControl(type);
  controlSelect.value = "";
});

// ‚öôÔ∏è H√ÄM CH√çNH T·∫†O CONTROL
function addControl(type) {
  const ctrl = document.createElement("div");
  ctrl.className = "control";
  ctrl.dataset.type = type;
  ctrl.style.left = "40px";
  ctrl.style.top = "40px";
  ctrl.style.width = "120px";
  ctrl.style.height = "30px";
  ctrl.dataset.caption = type;
  ctrl.textContent = type;
  ctrl.dataset.locked = "false";
  ctrl.dataset.id = `${type}_${Date.now()}`;

  // MainForm ch·ªâ cho ph√©p 1 c√°i
  if (type === "MainForm") {
    const exists = [...canvas.children].find(c => c.dataset.type === "MainForm");
    if (exists) {
      alert("‚ö†Ô∏è Ch·ªâ ƒë∆∞·ª£c c√≥ 1 MainForm duy nh·∫•t!");
      return;
    }
    ctrl.style.width = "800px";
    ctrl.style.height = "600px";
    ctrl.style.left = "10px";
    ctrl.style.top = "10px";
  }

  makeDraggable(ctrl);
  canvas.appendChild(ctrl);
  selectControl(ctrl);
  saveState();
}

// ==============================
// üñ±Ô∏è K√âO TH·∫¢ CONTROL + SNAP GRID
// ==============================
function makeDraggable(ctrl) {
  ctrl.addEventListener("mousedown", (e) => {
    if (ctrl.dataset.locked === "true") return;
    selectedControl = ctrl;
    selectControl(ctrl);
    isDragging = true;
    offsetX = e.offsetX;
    offsetY = e.offsetY;
  });

  window.addEventListener("mousemove", (e) => {
    if (!isDragging || ctrl.dataset.locked === "true") return;
    const rect = canvas.getBoundingClientRect();
    let x = e.clientX - rect.left - offsetX;
    let y = e.clientY - rect.top - offsetY;
    // Snap grid 8px
    x = Math.round(x / 8) * 8;
    y = Math.round(y / 8) * 8;
    ctrl.style.left = x + "px";
    ctrl.style.top = y + "px";
    updatePropertiesPanel(ctrl);
    updateCodePreview();
  });

  window.addEventListener("mouseup", () => {
    if (isDragging) {
      isDragging = false;
      saveState();
    }
  });

  ctrl.addEventListener("click", (e) => {
    e.stopPropagation();
    selectControl(ctrl);
  });
}

// ==============================
// üìã PANEL THU·ªòC T√çNH
// ==============================
function selectControl(ctrl) {
  selectedControl = ctrl;
  document.querySelectorAll(".control").forEach(c => c.style.outline = "none");
  ctrl.style.outline = `2px solid var(--accent)`;
  updatePropertiesPanel(ctrl);
}

function updatePropertiesPanel(ctrl) {
  const id = ctrl.dataset.id;
  const type = ctrl.dataset.type;
  const caption = ctrl.dataset.caption;
  const locked = ctrl.dataset.locked === "true";
  const x = parseInt(ctrl.style.left);
  const y = parseInt(ctrl.style.top);
  const w = parseInt(ctrl.style.width);
  const h = parseInt(ctrl.style.height);

  propertyContent.innerHTML = `
    <div class='property'><label>ID:</label><input id='prop_id' value='${id}'></div>
    <div class='property'><label>Lo·∫°i:</label><input id='prop_type' value='${type}' disabled></div>
    <div class='property'><label>Caption (N·ªôi dung):</label><input id='prop_caption' value='${caption}'></div>
    <div class='property'><label>X:</label><input id='prop_x' type='number' value='${x}'></div>
    <div class='property'><label>Y:</label><input id='prop_y' type='number' value='${y}'></div>
    <div class='property'><label>R·ªông:</label><input id='prop_w' type='number' value='${w}'></div>
    <div class='property'><label>Cao:</label><input id='prop_h' type='number' value='${h}'></div>
    <div class='property'><label><input id='prop_locked' type='checkbox' ${locked ? "checked":""}> Kh√≥a control</label></div>
  `;

  // L·∫Øng nghe thay ƒë·ªïi
  document.getElementById("prop_caption").addEventListener("input", e => {
    ctrl.dataset.caption = e.target.value;
    ctrl.textContent = e.target.value;
    updateCodePreview();
  });
  ["x","y","w","h"].forEach(k=>{
    document.getElementById(`prop_${k}`).addEventListener("input", e=>{
      const val = parseInt(e.target.value);
      if(k==="x") ctrl.style.left = val+"px";
      if(k==="y") ctrl.style.top = val+"px";
      if(k==="w") ctrl.style.width = val+"px";
      if(k==="h") ctrl.style.height = val+"px";
      updateCodePreview();
    });
  });
  document.getElementById("prop_locked").addEventListener("change", e=>{
    ctrl.dataset.locked = e.target.checked;
    ctrl.classList.toggle("locked", e.target.checked);
  });
}

// ==============================
// üíæ L∆ØU / LOAD LAYOUT
// ==============================
function getLayout() {
  const data = [];
  canvas.querySelectorAll(".control").forEach(c=>{
    data.push({
      id: c.dataset.id,
      type: c.dataset.type,
      caption: c.dataset.caption,
      x: parseInt(c.style.left),
      y: parseInt(c.style.top),
      w: parseInt(c.style.width),
      h: parseInt(c.style.height),
      locked: c.dataset.locked === "true"
    });
  });
  return data;
}
function setLayout(data) {
  canvas.innerHTML = "";
  data.forEach(d=>{
    const ctrl = document.createElement("div");
    ctrl.className = "control";
    ctrl.dataset.type = d.type;
    ctrl.dataset.id = d.id;
    ctrl.dataset.caption = d.caption;
    ctrl.dataset.locked = d.locked;
    ctrl.textContent = d.caption;
    ctrl.style.left = d.x+"px";
    ctrl.style.top = d.y+"px";
    ctrl.style.width = d.w+"px";
    ctrl.style.height = d.h+"px";
    if(d.locked) ctrl.classList.add("locked");
    makeDraggable(ctrl);
    canvas.appendChild(ctrl);
  });
  updateCodePreview();
}
document.getElementById("saveBtn").onclick = ()=>{
  const blob = new Blob([JSON.stringify(getLayout(),null,2)], {type:"text/plain"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "layout.txt";
  a.click();
};
document.getElementById("loadBtn").onclick = ()=>{
  const inp = document.createElement("input");
  inp.type="file";
  inp.accept=".txt";
  inp.onchange = e=>{
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload = ev=>{
      const data = JSON.parse(ev.target.result);
      setLayout(data);
    };
    reader.readAsText(file);
  };
  inp.click();
};

// ==============================
// üîÅ UNDO STACK
// ==============================
function saveState(){
  const layout = JSON.stringify(getLayout());
  undoStack.push(layout);
  if(undoStack.length > MAX_UNDO) undoStack.shift();
}
document.getElementById("undoBtn").onclick = ()=>{
  if(undoStack.length < 2) return;
  undoStack.pop();
  const prev = JSON.parse(undoStack[undoStack.length-1]);
  setLayout(prev);
};

// ==============================
// üßπ CLEAR TO√ÄN B·ªò
// ==============================
document.getElementById("clearBtn").onclick = ()=>{
  if(!confirm("X√≥a to√†n b·ªô layout?")) return;
  canvas.innerHTML="";
  saveState();
  updateCodePreview();
};

// ==============================
// üóë REMOVE CONTROL
// ==============================
document.getElementById("removeBtn").onclick = ()=>{
  if(!selectedControl) return;
  selectedControl.remove();
  selectedControl=null;
  propertyContent.textContent="Ch·ªçn 1 control ƒë·ªÉ ch·ªânh thu·ªôc t√≠nh";
  saveState();
  updateCodePreview();
};

// ==============================
// üí¨ CLICK NGO√ÄI CANVAS
// ==============================
canvas.addEventListener("click", ()=>{
  selectedControl=null;
  document.querySelectorAll(".control").forEach(c=>c.style.outline="none");
  propertyContent.textContent="Ch·ªçn 1 control ƒë·ªÉ ch·ªânh thu·ªôc t√≠nh";
});
</script>

