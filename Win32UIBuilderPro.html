<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Win32 UI Builder Pro v7.4 Live</title>
<style>
:root {
  --bg: #f5f5f5;
  --panel: #ffffff;
  --text: #222;
  --border: #ccc;
  --accent: #0078D7;
  --control-bg: #fafafa;
}
body.dark {
  --bg: #1e1e1e;
  --panel: #252526;
  --text: #f5f5f5;
  --border: #555;
  --accent: #3794ff;
  --control-bg: #f7f7f7;
}
body {
  margin: 0;
  font-family: "Segoe UI", sans-serif;
  background: var(--bg);
  color: var(--text);
  display: flex;
  flex-direction: column;
  height: 100vh;
  overflow: hidden;
}

/* ===== Title ===== */
#titlebar {
  background: var(--accent);
  color: #fff;
  padding: 8px 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
#themeToggle {
  cursor: pointer;
  background: rgba(255,255,255,0.2);
  padding: 4px 10px;
  border-radius: 6px;
}
#themeToggle:hover { background: rgba(255,255,255,0.35); }

/* ===== Toolbar ===== */
#toolbar {
  background: var(--panel);
  border-bottom: 1px solid var(--border);
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  padding: 6px 8px;
}
#toolbar button, #toolbar select {
  padding: 6px 10px;
  border: 1px solid var(--border);
  background: var(--control-bg);
  cursor: pointer;
  border-radius: 4px;
  font-size: 13px;
}
#toolbar button:hover {
  background: var(--accent);
  color: #fff;
}

/* ===== Workspace ===== */
#workspace {
  flex: 1;
  display: flex;
  overflow: hidden;
}
#canvasWrapper {
  flex: 1;
  overflow: scroll;
  background: var(--panel);
  cursor: grab;
  position: relative;
}
#canvas {
  position: absolute;
  width: 8000px;
  height: 8000px;
  transform: translate(-4000px, -4000px);
  background-size: 10px 10px;
  background-image:
    linear-gradient(to right, var(--border) 1px, transparent 1px),
    linear-gradient(to bottom, var(--border) 1px, transparent 1px);
}
.axis {
  position: absolute;
  background: red;
  z-index: 1;
}
#axisX { height: 1px; width: 8000px; top: 4000px; left: 0; }
#axisY { width: 1px; height: 8000px; left: 4000px; top: 0; }

/* ===== Controls ===== */
.control {
  position: absolute;
  border: 1px solid var(--accent);
  background: var(--control-bg);
  color: var(--text);
  text-align: center;
  font-size: 12px;
  border-radius: 4px;
  cursor: move;
  user-select: none;
  box-shadow: 0 1px 2px rgba(0,0,0,0.1);
}
.control.locked {
  border: 1px dotted var(--accent);
  cursor: not-allowed;
  opacity: 1;
}

/* ===== Property Panel ===== */
#propertyPanel {
  width: 260px;
  background: var(--panel);
  border-left: 1px solid var(--border);
  padding: 8px;
  overflow-y: auto;
}
#propertyPanel h3 {
  margin: 0 0 8px 0;
  border-bottom: 1px solid var(--border);
  padding-bottom: 4px;
}
.property { margin-bottom: 8px; }
.property label {
  font-size: 12px;
  display: block;
  margin-bottom: 3px;
}
.property input {
  width: 100%;
  font-size: 12px;
  padding: 3px;
  border: 1px solid var(--border);
  border-radius: 3px;
  background: var(--control-bg);
  color: var(--text);
}

/* ===== Code Preview ===== */
#codePreview {
  background: var(--panel);
  color: var(--text);
  font-family: Consolas, monospace;
  font-size: 12px;
  border-top: 1px solid var(--border);
  padding: 10px;
  height: 200px;
  overflow: auto;
  white-space: pre;
}

/* ===== Popup ===== */
#popup {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: var(--accent);
  color: #fff;
  padding: 8px 16px;
  border-radius: 6px;
  display: none;
}
</style>
</head>
<body>
  <div id="titlebar">
    <span>Win32 UI Builder Pro v7.4</span>
    <div id="themeToggle">üåô Dark</div>
  </div>

  <div id="toolbar">
    <select id="controlSelect">
      <option value="">‚ûï Th√™m Control</option>
      <option value="MainForm">MainForm</option>
      <option value="Button">Button</option>
      <option value="Edit">Edit</option>
      <option value="Static">Static</option>
      <option value="Menu">Menu</option>
      <option value="MenuItem">MenuItem</option>
      <option value="TabControl">TabControl</option>
      <option value="TabPage">TabPage</option>
      <option value="ListView">ListView</option>
      <option value="TreeView">TreeView</option>
      <option value="ProgressBar">ProgressBar</option>
      <option value="DateTimePicker">DateTimePicker</option>
      <option value="SysLink">SysLink</option>
      <option value="CustomControl">CustomControl</option>
    </select>
     <button id="removeBtn">üóë X√≥a</button>
  <button id="undoBtn">üîÅ Undo</button>
  <button id="clearBtn">üßπ X√≥a t·∫•t c·∫£</button>
  <button id="saveBtn">üíæ L∆∞u layout</button>
  <button id="loadBtn">üìÇ N·∫°p layout</button>
  <button id="exportBtn">üì§ Xu·∫•t code</button>
  <select id="langSelect">
    <option value="cpp">C++</option>
    <option value="c">C</option>
    <option value="json">JSON</option>
    <option value="python">Python GUI</option>
  </select>
  </div>

  <div id="workspace">
    <div id="canvasWrapper">
      <div id="canvas">
        <div id="axisX" class="axis"></div>
        <div id="axisY" class="axis"></div>
      </div>
    </div>
    <div id="propertyPanel">
      <h3>Thu·ªôc t√≠nh</h3>
      <div id="propertyContent">Ch·ªçn control ƒë·ªÉ ch·ªânh</div>
    </div>
  </div>

  <div id="codePreview">// Code s·∫Ω hi·ªán ·ªü ƒë√¢y...</div>
  <div id="popup">‚úÖ ƒê√£ sao ch√©p!</div>
</body>
</html>
<script>
// =============================
// üß† PH·∫¶N 2 ‚Äì CORE LOGIC V7.4
// =============================

// C√°c ph·∫ßn t·ª≠ ch√≠nh
const canvasWrapper = document.getElementById("canvasWrapper");
const canvas = document.getElementById("canvas");
const propertyContent = document.getElementById("propertyContent");
const controlSelect = document.getElementById("controlSelect");
const themeToggle = document.getElementById("themeToggle");
const popup = document.getElementById("popup");

let selectedControl = null;
let isDragging = false;
let offsetX = 0, offsetY = 0;
let panning = false, panStart = {x:0,y:0}, scrollStart = {x:0,y:0};
const undoStack = [];
const MAX_UNDO = 5;

// =============================
// üåô DARK / LIGHT MODE
// =============================
themeToggle.addEventListener("click", () => {
  document.body.classList.toggle("dark");
  const dark = document.body.classList.contains("dark");
  themeToggle.textContent = dark ? "‚òÄÔ∏è Light" : "üåô Dark";
  localStorage.setItem("theme", dark ? "dark" : "light");
});
window.addEventListener("load",()=>{
  if(localStorage.getItem("theme")==="dark"){
    document.body.classList.add("dark");
    themeToggle.textContent="‚òÄÔ∏è Light";
  }
});

// =============================
// üì¶ T·∫†O CONTROL M·ªöI
// =============================
controlSelect.addEventListener("change", ()=>{
  const type = controlSelect.value;
  if(!type) return;
  addControl(type);
  controlSelect.value="";
});

function addControl(type, data=null){
  const c = document.createElement("div");
  c.className = "control";
  c.dataset.type = type;
  c.dataset.id = data?.id || `${type}_${Date.now()}`;
  c.dataset.caption = data?.caption || type;
  c.dataset.locked = data?.locked || "false";
  c.dataset.parent = data?.parent || "MainForm";
  c.style.width = (data?.w || 120)+"px";
  c.style.height = (data?.h || 30)+"px";
  c.style.left = (data?.x || 0)+"px";
  c.style.top = (data?.y || 0)+"px";
  c.textContent = c.dataset.caption;

  // TabControl t·ª± t·∫°o 3 TabPage
  if(type==="TabControl"){
    for(let i=1;i<=3;i++){
      const tab = {
        id:`TabPage_${Date.now()}_${i}`,
        type:"TabPage",
        caption:`Page${i}`,
        parent:c.dataset.id,
        x:8,y:24,w:200,h:150
      };
      addControl("TabPage", tab);
    }
  }

  makeDraggable(c);
  canvas.appendChild(c);
  selectControl(c);
  saveState();
}

// =============================
// üéØ K√âO TH·∫¢ & SNAP GRID
// =============================
function makeDraggable(ctrl){
  ctrl.addEventListener("mousedown", e=>{
    if(e.button===1 || e.button===2) return; // chu·ªôt gi·ªØa/ph·∫£i b·ªè qua
    if(ctrl.dataset.locked==="true") return;
    isDragging=true;
    selectedControl=ctrl;
    selectControl(ctrl);
    offsetX=e.offsetX; offsetY=e.offsetY;
    e.stopPropagation();
  });

  window.addEventListener("mousemove", e=>{
    if(isDragging && selectedControl){
      const rect = canvas.getBoundingClientRect();
      let x = e.clientX - rect.left - offsetX;
      let y = e.clientY - rect.top - offsetY;
      x=Math.round(x/8)*8; y=Math.round(y/8)*8;
      selectedControl.style.left = x+"px";
      selectedControl.style.top = y+"px";
      updateProperties(selectedControl);
    }
  });
  window.addEventListener("mouseup", ()=>{
    if(isDragging){ isDragging=false; saveState(); }
  });
}

// =============================
// üß≠ PANNING CANVAS (chu·ªôt ph·∫£i)
// =============================
canvasWrapper.addEventListener("mousedown", e=>{
  if(e.button===2){
    panning=true;
    panStart={x:e.clientX,y:e.clientY};
    scrollStart={x:canvasWrapper.scrollLeft,y:canvasWrapper.scrollTop};
    canvasWrapper.style.cursor="grabbing";
  }
});
window.addEventListener("mouseup", ()=>{ panning=false; canvasWrapper.style.cursor="grab"; });
window.addEventListener("mousemove", e=>{
  if(panning){
    canvasWrapper.scrollLeft = scrollStart.x - (e.clientX - panStart.x);
    canvasWrapper.scrollTop = scrollStart.y - (e.clientY - panStart.y);
  }
});
canvasWrapper.addEventListener("contextmenu", e=>e.preventDefault());

// =============================
// üìã PANEL THU·ªòC T√çNH
// =============================
function selectControl(ctrl){
  document.querySelectorAll(".control").forEach(c=>c.style.outline="none");
  ctrl.style.outline=`2px solid var(--accent)`;
  selectedControl=ctrl;
  updateProperties(ctrl);
}

function updateProperties(ctrl){
  const id=ctrl.dataset.id, type=ctrl.dataset.type, caption=ctrl.dataset.caption, parent=ctrl.dataset.parent;
  const x=parseInt(ctrl.style.left), y=parseInt(ctrl.style.top), w=parseInt(ctrl.style.width), h=parseInt(ctrl.style.height);
  const locked=ctrl.dataset.locked==="true";
  propertyContent.innerHTML=`
  <div class='property'><label>ID:</label><input id='p_id' value='${id}'></div>
  <div class='property'><label>Lo·∫°i:</label><input value='${type}' disabled></div>
  <div class='property'><label>Caption:</label><input id='p_caption' value='${caption}'></div>
  <div class='property'><label>X:</label><input id='p_x' type='number' value='${x}'></div>
  <div class='property'><label>Y:</label><input id='p_y' type='number' value='${y}'></div>
  <div class='property'><label>R·ªông:</label><input id='p_w' type='number' value='${w}'></div>
  <div class='property'><label>Cao:</label><input id='p_h' type='number' value='${h}'></div>
  <div class='property'><label>ParentID:</label><input id='p_parent' value='${parent}'></div>
  <div class='property'><label><input id='p_locked' type='checkbox' ${locked?"checked":""}> Kh√≥a control</label></div>
  `;
  document.getElementById("p_caption").addEventListener("input",e=>{
    ctrl.dataset.caption=e.target.value; ctrl.textContent=e.target.value;
  });
  ["x","y","w","h"].forEach(k=>{
    document.getElementById("p_"+k).addEventListener("input",e=>{
      ctrl.style[k==="x"?"left":k==="y"?"top":k==="w"?"width":"height"] = e.target.value+"px";
    });
  });
  document.getElementById("p_locked").addEventListener("change",e=>{
    ctrl.dataset.locked=e.target.checked?"true":"false";
    ctrl.classList.toggle("locked",e.target.checked);
  });
}

// =============================
// üíæ L∆ØU / N·∫†P / UNDO / CLEAR
// =============================
function getLayout(){
  const arr=[];
  canvas.querySelectorAll(".control").forEach(c=>{
    arr.push({
      id:c.dataset.id, type:c.dataset.type, caption:c.dataset.caption,
      x:parseInt(c.style.left), y:parseInt(c.style.top),
      w:parseInt(c.style.width), h:parseInt(c.style.height),
      locked:c.dataset.locked==="true", parent:c.dataset.parent
    });
  });
  return arr;
}
function setLayout(data){
  canvas.innerHTML='<div id="axisX" class="axis" style="top:4000px;width:8000px;height:1px;left:0;background:red"></div><div id="axisY" class="axis" style="left:4000px;width:1px;height:8000px;top:0;background:red"></div>';
  data.forEach(d=>addControl(d.type,d));
}
function saveState(){
  undoStack.push(JSON.stringify(getLayout()));
  if(undoStack.length>MAX_UNDO) undoStack.shift();
}
document.getElementById("undoBtn").onclick=()=>{
  if(undoStack.length<2) return;
  undoStack.pop();
  setLayout(JSON.parse(undoStack[undoStack.length-1]));
};
document.getElementById("clearBtn").onclick=()=>{
  if(!confirm("X√≥a to√†n b·ªô layout?")) return;
  canvas.innerHTML="";
  saveState();
};
document.getElementById("saveBtn").onclick=()=>{
  const blob=new Blob([JSON.stringify(getLayout(),null,2)],{type:"text/plain"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob); a.download="layout_v74.txt"; a.click();
};
document.getElementById("loadBtn").onclick=()=>{
  const inp=document.createElement("input"); inp.type="file"; inp.accept=".txt,.json";
  inp.onchange=e=>{
    const f=e.target.files[0]; const r=new FileReader();
    r.onload=ev=>{ setLayout(JSON.parse(ev.target.result)); };
    r.readAsText(f);
  };
  inp.click();
};
document.getElementById("removeBtn").onclick=()=>{
  if(selectedControl){ selectedControl.remove(); selectedControl=null; propertyContent.textContent="Ch·ªçn control ƒë·ªÉ ch·ªânh"; saveState(); }
};

// =============================
// ü™ü MENU / TABCONTROL LOGIC
// =============================

// Khi click v√†o Menu ho·∫∑c TabControl ‚Üí ch·ªâ hi·ªán control con thu·ªôc v√πng ƒë√≥
canvas.addEventListener("click", e=>{
  const t=e.target.closest(".control");
  if(!t) return;
  const type=t.dataset.type;
  if(type==="Menu"||type==="TabControl"||type==="TabPage"||type==="MenuItem"){
    switchContainer(t);
    e.stopPropagation();
  } else selectControl(t);
});

function switchContainer(container){
  const id=container.dataset.id;
  document.querySelectorAll(".control").forEach(c=>{
    if(c.dataset.parent===id || c.dataset.id===id){
      c.style.display="block";
    } else if(c.dataset.parent!=="MainForm"){
      c.style.display="none";
    }
  });
  selectControl(container);
}

// =============================
// üí¨ CLICK NGO√ÄI CANVAS
// =============================
canvas.addEventListener("click", e=>{
  if(e.target===canvas){
    selectedControl=null;
    document.querySelectorAll(".control").forEach(c=>c.style.outline="none");
    propertyContent.textContent="Ch·ªçn control ƒë·ªÉ ch·ªânh";
  }
});
</script>
<script>
// =============================
// üß† PH·∫¶N 2 ‚Äì CORE LOGIC V7.4
// =============================

// C√°c ph·∫ßn t·ª≠ ch√≠nh
const canvasWrapper = document.getElementById("canvasWrapper");
const canvas = document.getElementById("canvas");
const propertyContent = document.getElementById("propertyContent");
const controlSelect = document.getElementById("controlSelect");
const themeToggle = document.getElementById("themeToggle");
const popup = document.getElementById("popup");

let selectedControl = null;
let isDragging = false;
let offsetX = 0, offsetY = 0;
let panning = false, panStart = {x:0,y:0}, scrollStart = {x:0,y:0};
const undoStack = [];
const MAX_UNDO = 5;

// =============================
// üåô DARK / LIGHT MODE
// =============================
themeToggle.addEventListener("click", () => {
  document.body.classList.toggle("dark");
  const dark = document.body.classList.contains("dark");
  themeToggle.textContent = dark ? "‚òÄÔ∏è Light" : "üåô Dark";
  localStorage.setItem("theme", dark ? "dark" : "light");
});
window.addEventListener("load",()=>{
  if(localStorage.getItem("theme")==="dark"){
    document.body.classList.add("dark");
    themeToggle.textContent="‚òÄÔ∏è Light";
  }
});

// =============================
// üì¶ T·∫†O CONTROL M·ªöI
// =============================
controlSelect.addEventListener("change", ()=>{
  const type = controlSelect.value;
  if(!type) return;
  addControl(type);
  controlSelect.value="";
});

function addControl(type, data=null){
  const c = document.createElement("div");
  c.className = "control";
  c.dataset.type = type;
  c.dataset.id = data?.id || `${type}_${Date.now()}`;
  c.dataset.caption = data?.caption || type;
  c.dataset.locked = data?.locked || "false";
  c.dataset.parent = data?.parent || "MainForm";
  c.style.width = (data?.w || 120)+"px";
  c.style.height = (data?.h || 30)+"px";
  c.style.left = (data?.x || 0)+"px";
  c.style.top = (data?.y || 0)+"px";
  c.textContent = c.dataset.caption;

  // TabControl t·ª± t·∫°o 3 TabPage
  if(type==="TabControl"){
    for(let i=1;i<=3;i++){
      const tab = {
        id:`TabPage_${Date.now()}_${i}`,
        type:"TabPage",
        caption:`Page${i}`,
        parent:c.dataset.id,
        x:8,y:24,w:200,h:150
      };
      addControl("TabPage", tab);
    }
  }

  makeDraggable(c);
  canvas.appendChild(c);
  selectControl(c);
  saveState();
}

// =============================
// üéØ K√âO TH·∫¢ & SNAP GRID
// =============================
function makeDraggable(ctrl){
  ctrl.addEventListener("mousedown", e=>{
    if(e.button===1 || e.button===2) return; // chu·ªôt gi·ªØa/ph·∫£i b·ªè qua
    if(ctrl.dataset.locked==="true") return;
    isDragging=true;
    selectedControl=ctrl;
    selectControl(ctrl);
    offsetX=e.offsetX; offsetY=e.offsetY;
    e.stopPropagation();
  });

  window.addEventListener("mousemove", e=>{
    if(isDragging && selectedControl){
      const rect = canvas.getBoundingClientRect();
      let x = e.clientX - rect.left - offsetX;
      let y = e.clientY - rect.top - offsetY;
      x=Math.round(x/8)*8; y=Math.round(y/8)*8;
      selectedControl.style.left = x+"px";
      selectedControl.style.top = y+"px";
      updateProperties(selectedControl);
    }
  });
  window.addEventListener("mouseup", ()=>{
    if(isDragging){ isDragging=false; saveState(); }
  });
}

// =============================
// üß≠ PANNING CANVAS (chu·ªôt ph·∫£i)
// =============================
canvasWrapper.addEventListener("mousedown", e=>{
  if(e.button===2){
    panning=true;
    panStart={x:e.clientX,y:e.clientY};
    scrollStart={x:canvasWrapper.scrollLeft,y:canvasWrapper.scrollTop};
    canvasWrapper.style.cursor="grabbing";
  }
});
window.addEventListener("mouseup", ()=>{ panning=false; canvasWrapper.style.cursor="grab"; });
window.addEventListener("mousemove", e=>{
  if(panning){
    canvasWrapper.scrollLeft = scrollStart.x - (e.clientX - panStart.x);
    canvasWrapper.scrollTop = scrollStart.y - (e.clientY - panStart.y);
  }
});
canvasWrapper.addEventListener("contextmenu", e=>e.preventDefault());

// =============================
// üìã PANEL THU·ªòC T√çNH
// =============================
function selectControl(ctrl){
  document.querySelectorAll(".control").forEach(c=>c.style.outline="none");
  ctrl.style.outline=`2px solid var(--accent)`;
  selectedControl=ctrl;
  updateProperties(ctrl);
}

function updateProperties(ctrl){
  const id=ctrl.dataset.id, type=ctrl.dataset.type, caption=ctrl.dataset.caption, parent=ctrl.dataset.parent;
  const x=parseInt(ctrl.style.left), y=parseInt(ctrl.style.top), w=parseInt(ctrl.style.width), h=parseInt(ctrl.style.height);
  const locked=ctrl.dataset.locked==="true";
  propertyContent.innerHTML=`
  <div class='property'><label>ID:</label><input id='p_id' value='${id}'></div>
  <div class='property'><label>Lo·∫°i:</label><input value='${type}' disabled></div>
  <div class='property'><label>Caption:</label><input id='p_caption' value='${caption}'></div>
  <div class='property'><label>X:</label><input id='p_x' type='number' value='${x}'></div>
  <div class='property'><label>Y:</label><input id='p_y' type='number' value='${y}'></div>
  <div class='property'><label>R·ªông:</label><input id='p_w' type='number' value='${w}'></div>
  <div class='property'><label>Cao:</label><input id='p_h' type='number' value='${h}'></div>
  <div class='property'><label>ParentID:</label><input id='p_parent' value='${parent}'></div>
  <div class='property'><label><input id='p_locked' type='checkbox' ${locked?"checked":""}> Kh√≥a control</label></div>
  `;
  document.getElementById("p_caption").addEventListener("input",e=>{
    ctrl.dataset.caption=e.target.value; ctrl.textContent=e.target.value;
  });
  ["x","y","w","h"].forEach(k=>{
    document.getElementById("p_"+k).addEventListener("input",e=>{
      ctrl.style[k==="x"?"left":k==="y"?"top":k==="w"?"width":"height"] = e.target.value+"px";
    });
  });
  document.getElementById("p_locked").addEventListener("change",e=>{
    ctrl.dataset.locked=e.target.checked?"true":"false";
    ctrl.classList.toggle("locked",e.target.checked);
  });
}

// =============================
// üíæ L∆ØU / N·∫†P / UNDO / CLEAR
// =============================
function getLayout(){
  const arr=[];
  canvas.querySelectorAll(".control").forEach(c=>{
    arr.push({
      id:c.dataset.id, type:c.dataset.type, caption:c.dataset.caption,
      x:parseInt(c.style.left), y:parseInt(c.style.top),
      w:parseInt(c.style.width), h:parseInt(c.style.height),
      locked:c.dataset.locked==="true", parent:c.dataset.parent
    });
  });
  return arr;
}
function setLayout(data){
  canvas.innerHTML='<div id="axisX" class="axis" style="top:4000px;width:8000px;height:1px;left:0;background:red"></div><div id="axisY" class="axis" style="left:4000px;width:1px;height:8000px;top:0;background:red"></div>';
  data.forEach(d=>addControl(d.type,d));
}
function saveState(){
  undoStack.push(JSON.stringify(getLayout()));
  if(undoStack.length>MAX_UNDO) undoStack.shift();
}
document.getElementById("undoBtn").onclick=()=>{
  if(undoStack.length<2) return;
  undoStack.pop();
  setLayout(JSON.parse(undoStack[undoStack.length-1]));
};
document.getElementById("clearBtn").onclick=()=>{
  if(!confirm("X√≥a to√†n b·ªô layout?")) return;
  canvas.innerHTML="";
  saveState();
};
document.getElementById("saveBtn").onclick=()=>{
  const blob=new Blob([JSON.stringify(getLayout(),null,2)],{type:"text/plain"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob); a.download="layout_v74.txt"; a.click();
};
document.getElementById("loadBtn").onclick=()=>{
  const inp=document.createElement("input"); inp.type="file"; inp.accept=".txt,.json";
  inp.onchange=e=>{
    const f=e.target.files[0]; const r=new FileReader();
    r.onload=ev=>{ setLayout(JSON.parse(ev.target.result)); };
    r.readAsText(f);
  };
  inp.click();
};
document.getElementById("removeBtn").onclick=()=>{
  if(selectedControl){ selectedControl.remove(); selectedControl=null; propertyContent.textContent="Ch·ªçn control ƒë·ªÉ ch·ªânh"; saveState(); }
};

// =============================
// ü™ü MENU / TABCONTROL LOGIC
// =============================

// Khi click v√†o Menu ho·∫∑c TabControl ‚Üí ch·ªâ hi·ªán control con thu·ªôc v√πng ƒë√≥
canvas.addEventListener("click", e=>{
  const t=e.target.closest(".control");
  if(!t) return;
  const type=t.dataset.type;
  if(type==="Menu"||type==="TabControl"||type==="TabPage"||type==="MenuItem"){
    switchContainer(t);
    e.stopPropagation();
  } else selectControl(t);
});

function switchContainer(container){
  const id=container.dataset.id;
  document.querySelectorAll(".control").forEach(c=>{
    if(c.dataset.parent===id || c.dataset.id===id){
      c.style.display="block";
    } else if(c.dataset.parent!=="MainForm"){
      c.style.display="none";
    }
  });
  selectControl(container);
}

// =============================
// üí¨ CLICK NGO√ÄI CANVAS
// =============================
canvas.addEventListener("click", e=>{
  if(e.target===canvas){
    selectedControl=null;
    document.querySelectorAll(".control").forEach(c=>c.style.outline="none");
    propertyContent.textContent="Ch·ªçn control ƒë·ªÉ ch·ªânh";
  }
});
</script>
