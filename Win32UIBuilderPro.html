<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Win32 UI Builder Pro v9.9 Zoom Studio</title>
<style>
:root {
  --accent:#0078D7;
  --border:#ccc;
  --text:#222;
  --bg:#f5f5f5;
  --panel:#fff;
  --control-bg:#fafafa;
  --radius:6px;
  --hover:#cce7ff;
}
body.dark {
  --bg:#121212;
  --panel:#1e1e1e;
  --text:#ffffff;
  --border:#333;
  --accent:#3794ff;
  --control-bg:#1a1a1a;
  --hover:#2d2d2d;
}
body.win11 {
  --bg:linear-gradient(135deg,#f5faff,#e8f0ff);
  --panel:rgba(255,255,255,0.85);
  backdrop-filter:blur(10px) saturate(160%);
  --radius:10px;
}
body.win10 {
  --bg:#f0f0f0;
  --panel:#fff;
  --radius:4px;
}
body {
  margin:0;
  font-family:"Segoe UI",sans-serif;
  background:var(--bg);
  color:var(--text);
  display:flex;
  flex-direction:column;
  height:100vh;
  overflow:hidden;
}

/* ===== Titlebar ===== */
#titlebar {
  background:var(--accent);
  color:#fff;
  padding:8px 16px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-weight:500;
  font-size:14px;
}

/* ===== Toolbar ===== */
#toolbar {
  background:var(--panel);
  border-bottom:1px solid var(--border);
  display:flex;
  flex-wrap:wrap;
  gap:6px;
  padding:6px 8px;
  align-items:center;
}
#toolbar button,
#toolbar select {
  padding:6px 10px;
  border:1px solid var(--border);
  background:var(--control-bg);
  cursor:pointer;
  border-radius:4px;
  font-size:13px;
  color:var(--text);
}
#toolbar button:hover {
  background:var(--accent);
  color:#fff;
}
#zoomContainer {
  margin-left:auto;
  display:flex;
  align-items:center;
  gap:6px;
}
#zoomSlider {
  width:120px;
}
#zoomValue {
  font-size:12px;
  width:40px;
  text-align:right;
}

/* ===== Workspace ===== */
#workspace {
  flex:1;
  display:flex;
  overflow:hidden;
}
#canvasWrapper {
  flex:1;
  overflow:scroll;
  background:var(--panel);
  cursor:grab;
  position:relative;
}
#canvas {
  position:absolute;
  width:8000px;
  height:8000px;
  background-size:10px 10px;
  background-image:
   linear-gradient(to right,var(--border)1px,transparent 1px),
   linear-gradient(to bottom,var(--border)1px,transparent 1px);
  transform-origin:0 0;
  transition:transform 0.1s ease-out;
}
.axis {
  position:absolute;
  background:red;
  z-index:1;
}
#axisX {
  height:1px;
  width:8000px;
  top:4000px;
  left:0;
}
#axisY {
  width:1px;
  height:8000px;
  left:4000px;
  top:0;
}

/* ===== Control Base ===== */
.control {
  position:absolute;
  border:1px solid var(--accent);
  background:var(--control-bg);
  color:var(--text);
  text-align:center;
  font-size:12px;
  border-radius:var(--radius);
  cursor:move;
  user-select:none;
  box-shadow:0 1px 2px rgba(0,0,0,.15);
  transition:background .15s,border .15s,box-shadow .15s;
}
.control.selected {
  box-shadow:0 0 8px var(--accent);
}
.control.locked {
  border:1px dotted var(--accent);
  cursor:not-allowed;
  opacity:.7;
}

/* ===== MainForm ===== */
.ctrl-MainForm {
  position: relative;
  border: 1px solid var(--border);
  background: linear-gradient(#ffffff, #eeeeee);
  border-radius: var(--radius);
  box-shadow: 0 2px 4px rgba(0,0,0,0.15);
  overflow: hidden;
}
.ctrl-MainForm .title {
  position: absolute;
  top: 0; left: 0; right: 70px;
  height: 28px;
  line-height: 28px;
  padding-left: 10px;
  font-weight: 500;
  background: #ffffff;
  color: #000;
  user-select: none;
  cursor: move;
  border-top-left-radius: var(--radius);
  border-top-right-radius: var(--radius);
}
body.dark .ctrl-MainForm .title {
  background: #222;
  color: #fff;
}
.ctrl-MainForm .win-btns {
  position: absolute;
  top: 0; right: 0;
  height: 28px;
  display: flex;
  align-items: center;
  gap: 2px;
  padding-right: 4px;
  z-index: 5;
}
.ctrl-MainForm .win-btn {
  width: 28px;
  height: 22px;
  text-align: center;
  line-height: 20px;
  border: none;
  background: transparent;
  color: #000;
  font-weight: bold;
  cursor: pointer;
  border-radius: 3px;
  transition: background .2s;
}
body.dark .ctrl-MainForm .win-btn { color:#fff; }
.ctrl-MainForm .win-btn:hover {
  background: #e3bbbb;
}
.ctrl-MainForm .win-btn.close:hover {
  background: #e81123;
  color: #fff;
}
.ctrl-MainForm .content {
  position: absolute;
  top: 28px; left: 0; right: 0; bottom: 0;
  background: var(--panel);
  color: var(--text);
  padding: 10px;
}

/* ===== Property Panel ===== */
#propertyPanel {
  width:280px;
  background:var(--panel);
  border-left:1px solid var(--border);
  padding:8px;
  overflow-y:auto;
}
#propertyPanel h3 {
  margin:0 0 8px;
  border-bottom:1px solid var(--border);
  padding-bottom:4px;
  color:var(--accent);
}
.property {margin-bottom:8px;}
.property label {
  font-size:12px;
  display:block;
  margin-bottom:3px;
}
.property input,
#propertyPanel select {
  width:100%;
  font-size:12px;
  padding:3px;
  border:1px solid var(--border);
  border-radius:3px;
  background:var(--control-bg);
  color:var(--text);
}
.property .row {
  display:flex;
  gap:6px;
  align-items:center;
}

/* ===== Style Popup ===== */
#stylePopup {
  position:absolute;
  z-index:100;
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:6px;
  padding:8px;
  width:230px;
  max-height:300px;
  overflow:auto;
  display:none;
  box-shadow:0 2px 8px rgba(0,0,0,.25);
}
#stylePopup h4 {
  margin:6px 0 4px;
  font-size:12px;
  border-bottom:1px solid var(--border);
}
#stylePopup label {
  font-size:12px;
  display:block;
  margin-bottom:2px;
}

/* ===== Output ===== */
#outputZone {
  background:#1e1e1e;
  color:#eee;
  font-family:Consolas,monospace;
  font-size:12px;
  border-top:1px solid #333;
  padding:8px;
  height:160px;
  overflow:auto;
  white-space:pre;
  position:relative;
}
#copyOutput {
  position:absolute;
  top:4px;
  right:8px;
  background:#0078D7;
  color:#fff;
  border:none;
  border-radius:4px;
  padding:3px 6px;
  font-size:11px;
  cursor:pointer;
}

/* ===== MenuBar ===== */
.ctrl-MenuBar {
  display:flex;
  align-items:center;
  background:transparent !important;
  border:none !important;
  border-radius:0;
  padding:0 4px;
  height:26px;
  user-select:none;
  overflow-x:auto;
  white-space:nowrap;
  box-shadow:none !important;
}
.ctrl-MenuBar .menu-tabs {
  display:flex;
  align-items:center;
  gap:6px;
  width:100%;
}
.menu-tab {
  background:transparent !important;
  border:none;
  outline:none;
  padding:3px 8px;
  border-radius:0;
  font-size:13px;
  cursor:pointer;
  color:#000;
  transition:color 0.2s;
}
body.dark .menu-tab { color:#fff; }
.menu-tab:hover {
  color:#0078D7;
  background:transparent !important;
}
.menu-add {
  background:transparent !important;
  color:#000;
  border:none;
  border-radius:0;
  width:22px;
  height:20px;
  text-align:center;
  line-height:18px;
  cursor:pointer;
  font-weight:bold;
  margin-left:6px;
  flex-shrink:0;
  transition:color 0.2s;
}
body.dark .menu-add { color:#fff; }
.menu-add:hover {
  color:#0078D7;
  background:transparent !important;
}
</style>
</head>
<body class="win11">
<div id="titlebar">
  <span>Win32 UI Builder Pro v9.9 Zoom Studio - By ChatGPT Tr·∫ßn Thanh Tr∆∞·ªùng</span>
  <button id="themeToggle">üåô Dark</button>
</div>

<div id="toolbar">
  <select id="controlSelect">
    <option value="">‚ûï Th√™m Control</option>
    <option>MainForm</option><option>MenuBar</option><option>Button</option>
    <option>Edit</option><option>Static</option><option>ComboBox</option>
    <option>ListBox</option><option>CheckBox</option><option>RadioButton</option>
    <option>GroupBox</option><option>TreeView</option><option>ListView</option>
    <option>ProgressBar</option><option>DateTimePicker</option>
    <option>TabControl</option><option>TabPage</option><option>SysLink</option>
    <option>CustomControl</option>
  </select>
  <button id="removeBtn">üóë X√≥a</button>
  <button id="undoBtn">üîÅ Undo</button>
  <button id="clearBtn">üßπ X√≥a t·∫•t c·∫£</button>
  <button id="lockBtn">üîí Kh√≥a to√†n b·ªô</button>
  <button id="saveBtn">üíæ L∆∞u layout</button>
  <button id="loadBtn">üìÇ N·∫°p layout</button>
  <button id="copyJSON">üìã Copy JSON</button>
  <select id="themeSelect">
    <option value="win11">ü™ü Win11</option>
    <option value="win10">ü™ü Win10</option>
  </select>
  <select id="exportSelect">
  <option value="cpp">üì§ Xu·∫•t Code C++</option>
  <option value="json">üìú Xu·∫•t Layout JSON</option>
  <option value="ts">üß© Xu·∫•t Code TypeScript</option>
  <option value="py">üêç Xu·∫•t Code Python (tkinter)</option>
</select>
  <button id="exportBtn">üì§ Xu·∫•t Code</button>
  <div id="zoomContainer">
    <label for="zoomSlider">üîç</label>
    <input id="zoomSlider" type="range" min="25" max="400" step="5" value="100">
    <span id="zoomValue">100%</span>
  </div>
</div>

<div id="workspace">
  <div id="canvasWrapper">
    <div id="canvas">
      <div id="axisX" class="axis"></div>
      <div id="axisY" class="axis"></div>
    </div>
  </div>

  <div id="propertyPanel">
    <h3>Thu·ªôc t√≠nh</h3>
    <div class="property">
      <label>üé® M√†u n·ªÅn:</label>
      <div class="row">
        <input type="color" id="colorPicker" value="#fafafa" style="flex:0 0 40px;height:28px;cursor:pointer;">
        <input type="text" id="colorInput" value="#fafafa" style="flex:1;">
      </div>
    </div>
    <div class="property">
      <label>üî† Font:</label>
      <select id="fontSelect">
        <option>Segoe UI</option><option>Roboto</option><option>Tahoma</option><option>Be Vietnam Pro</option>
      </select>
    </div>
    <div id="propertyContent">Ch·ªçn control ƒë·ªÉ ch·ªânh</div>
  </div>
</div>

<div id="outputZone">
  <button id="copyOutput">Copy</button>
// Code s·∫Ω hi·ªán ·ªü ƒë√¢y...
</div>
<script>
window.addEventListener("DOMContentLoaded", () => {
  const canvasWrapper = document.getElementById("canvasWrapper");
  const canvas = document.getElementById("canvas");
  const propertyContent = document.getElementById("propertyContent");
  const colorPicker = document.getElementById("colorPicker");
  const colorInput = document.getElementById("colorInput");
  const fontSelect = document.getElementById("fontSelect");
  const controlSelect = document.getElementById("controlSelect");
  const themeToggle = document.getElementById("themeToggle");
  const themeSelect = document.getElementById("themeSelect");
  const zoomSlider = document.getElementById("zoomSlider");
  const zoomValue = document.getElementById("zoomValue");

  const CENTER = 4000;
  let selected = null, isDragging = false, ox = 0, oy = 0, locked = false, zoomLevel = 100;
  const undoStack = [], MAX_UNDO = 20;

  // üåô Dark/Light toggle
  themeToggle.onclick = () => {
    document.body.classList.toggle("dark");
    themeToggle.textContent = document.body.classList.contains("dark") ? "‚òÄÔ∏è Light" : "üåô Dark";
  };

  // ü™ü Theme Switch
  themeSelect.onchange = () => {
    document.body.classList.remove("win10", "win11");
    document.body.classList.add(themeSelect.value);
  };
  document.getElementById("removeBtn").onclick = () => {
    if (!selected) return alert("‚ö†Ô∏è Ch∆∞a ch·ªçn control n√†o ƒë·ªÉ x√≥a!");
    selected.remove();
    selected = null;
    saveState();
  };

  // üîÅ Undo layout tr∆∞·ªõc ƒë√≥
  document.getElementById("undoBtn").onclick = () => {
    if (undoStack.length <= 1) return alert("‚ö†Ô∏è Kh√¥ng c√≤n b∆∞·ªõc n√†o ƒë·ªÉ quay l·∫°i!");
    undoStack.pop(); // b·ªè tr·∫°ng th√°i hi·ªán t·∫°i
    const prev = JSON.parse(undoStack[undoStack.length - 1]);
    setLayout(prev);
  };

  // üßπ X√≥a to√†n b·ªô control
  document.getElementById("clearBtn").onclick = () => {
    if (!confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a to√†n b·ªô control kh√¥ng?")) return;
    canvas.innerHTML = '<div id="axisX" class="axis"></div><div id="axisY" class="axis"></div>';
    selected = null;
    saveState();
  };
    document.getElementById("copyJSON").onclick = () => {
    try {
      const layout = getLayout();
      const jsonText = JSON.stringify(layout, null, 2);
      navigator.clipboard.writeText(jsonText);
      document.getElementById("outputZone").textContent = jsonText;
      alert("‚úÖ ƒê√£ copy layout JSON hi·ªán t·∫°i!");
    } catch (err) {
      alert("‚ùå L·ªói khi copy JSON: " + err.message);
    }
  };
  // üé® Color picker
  function applyColor(val){ if(selected) selected.style.background = val; }
  colorPicker.oninput = () => { colorInput.value = colorPicker.value; applyColor(colorPicker.value); };
  colorInput.onchange = () => { colorPicker.value = colorInput.value; applyColor(colorInput.value); };

  // üî† Font select
  fontSelect.onchange = () => { if(selected) selected.style.fontFamily = fontSelect.value; };

  // üîç Zoom
  function updateZoom(){
    canvas.style.transform = `scale(${zoomLevel / 100})`;
    zoomValue.textContent = `${zoomLevel}%`;
  }
  zoomSlider.oninput = e => { zoomLevel = parseInt(e.target.value); updateZoom(); };
  canvasWrapper.addEventListener("wheel", e => {
    if(e.ctrlKey){
      e.preventDefault();
      zoomLevel += e.deltaY < 0 ? 1 : -1;
      zoomLevel = Math.min(400, Math.max(25, zoomLevel));
      zoomSlider.value = zoomLevel;
      updateZoom();
    }
  }, {passive:false});

  // üîí Lock to√†n b·ªô
  document.getElementById("lockBtn").onclick = () => {
    locked = !locked;
    document.querySelectorAll(".control").forEach(c => {
      c.classList.toggle("locked", locked);
      c.style.pointerEvents = locked ? "none" : "auto";
    });
  };
canvasWrapper.scrollLeft = CENTER - canvasWrapper.clientWidth / 2;
  canvasWrapper.scrollTop = CENTER - canvasWrapper.clientHeight / 2;
  // ‚ûï Add Control
  controlSelect.onchange = e => {
    const type = e.target.value;
    if(!type) return;
    addControl(type);
    e.target.value = "";
  };

  // üß© Add control logic
  function addControl(type, data=null){
    let el;
    if(type==="MainForm"){
      el=document.createElement("div");
      el.className="control ctrl-MainForm";
      el.innerHTML=`<div class="title">${data?.caption||"MainForm"}</div>
        <div class="win-btns">
          <div class="win-btn min">‚Äì</div>
          <div class="win-btn hide">‚ñ¢</div>
          <div class="win-btn close">‚úï</div>
        </div>
        <div class="content"></div>`;
      makeMainFormDraggable(el);
    } else if(type==="MenuBar"){
      el=document.createElement("div");
      el.className="control ctrl-MenuBar";
      const tabs=data?.tabs||["File","Edit","View"];
      el.innerHTML=`<div class="menu-tabs">${tabs.map(t=>`<div class="menu-tab" contenteditable="true">${t}</div>`).join("")}<div class="menu-add">+</div></div>`;
      el.querySelector(".menu-add").onclick=()=>{
        const t=document.createElement("div");
        t.className="menu-tab";
        t.contentEditable="true";
        t.textContent="New";
        el.querySelector(".menu-tabs").insertBefore(t, el.querySelector(".menu-add"));
      };
    } else if(type==="GroupBox"){
      el=document.createElement("fieldset");
      el.className="control";
      el.style.background="transparent";
      const legend=document.createElement("legend");
      legend.textContent=data?.caption||"GroupBox";
      el.appendChild(legend);
    } else if(type==="Button"){
      el=document.createElement("button");
      el.className="control";
      el.textContent=data?.caption||"Button";
    } else if(type==="Edit"){
      el=document.createElement("input");
      el.className="control";
      el.type="text";
      el.value=data?.caption||"Edit";
    } else if(type==="Static"){
      el=document.createElement("label");
      el.className="control";
      el.textContent=data?.caption||"Static";
    } else if(type==="CheckBox"||type==="RadioButton"){
      el=document.createElement("label");
      el.classList.add("control");
      el.style.display="inline-flex";
      el.style.alignItems="center";
      const input=document.createElement("input");
      input.type=type==="CheckBox"?"checkbox":"radio";
      input.style.marginRight="5px";
      const span=document.createElement("span");
      span.textContent=data?.caption||type;
      el.append(input,span);
    } else {
      el=document.createElement("div");
      el.className="control";
      el.textContent=data?.caption||type;
    }

    el.dataset.type=type;
    el.dataset.caption=data?.caption||type;
    el.dataset.comment=data?.comment||"";
    el.dataset.part=data?.part||"";
    el.dataset.style=data?.style||"WS_VISIBLE|WS_CHILD";
    el.dataset.lock=data?.lock||"false";

    const x=data?CENTER+data.x:CENTER;
    const y=data?CENTER+data.y:CENTER;
    el.style.left=x+"px"; el.style.top=y+"px";
    el.style.width=(data?.w||120)+"px"; el.style.height=(data?.h||30)+"px";

    canvas.appendChild(el);
    makeDraggable(el);
    selectControl(el);
    saveState();
  }

  // üñ± Drag control
  function makeDraggable(el){
    el.onmousedown=e=>{
      if(e.button!==0||locked)return;
      if(el.dataset.lock==="true")return;
      isDragging=true; ox=e.offsetX; oy=e.offsetY; selectControl(el);
    };
  }
  window.onmousemove=e=>{
    if(isDragging&&selected){
      const rect=canvas.getBoundingClientRect();
      selected.style.left=e.clientX-rect.left-ox+"px";
      selected.style.top=e.clientY-rect.top-oy+"px";
      updateProperty(selected);
    }
  };
  window.onmouseup=()=>{ if(isDragging){isDragging=false; saveState();} };

  // üß± MainForm Drag
  function makeMainFormDraggable(form){
    const title=form.querySelector(".title");
    let down=false,sx=0,sy=0;
    title.addEventListener("mousedown",e=>{
      down=true; sx=e.clientX-form.offsetLeft; sy=e.clientY-form.offsetTop; form.style.zIndex=9999;
    });
    window.addEventListener("mouseup",()=>down=false);
    window.addEventListener("mousemove",e=>{
      if(!down)return;
      form.style.left=(e.clientX-sx)+"px"; form.style.top=(e.clientY-sy)+"px";
    });
  }

  // üß© Property Panel
  function selectControl(ctrl){
    document.querySelectorAll(".control").forEach(c=>c.classList.remove("selected"));
    ctrl.classList.add("selected");
    selected=ctrl; updateProperty(ctrl);
  }

  // === Update Property ===
  function updateProperty(ctrl){
    const x=parseInt(ctrl.style.left)-CENTER;
    const y=parseInt(ctrl.style.top)-CENTER;
    const w=parseInt(ctrl.style.width)||120;
    const h=parseInt(ctrl.style.height)||30;
    const locked=ctrl.dataset.lock==="true"?"checked":"";
    propertyContent.innerHTML=`
      <div class='property'><label>X:</label><input id='p_x' type='number' value='${x}'></div>
      <div class='property'><label>Y:</label><input id='p_y' type='number' value='${y}'></div>
      <div class='property'><label>R·ªông:</label><input id='p_w' type='number' value='${w}'></div>
      <div class='property'><label>Cao:</label><input id='p_h' type='number' value='${h}'></div>
      <div class='property'><label>Hi·ªÉn th·ªã:</label><input id='p_caption' type='text' value='${ctrl.dataset.caption||""}'></div>
      <div class='property'><label>Comment:</label><input id='p_comment' type='text' value='${ctrl.dataset.comment||""}'></div>
      <div class='property'><label>Ph·∫ßn/Menu:</label><input id='p_part' type='text' value='${ctrl.dataset.part||""}'></div>
      <div class='property'><label>Style:</label><input id='p_style' readonly value='${ctrl.dataset.style}'></div>
      <div class='property'><label><input type='checkbox' id='p_lock' ${locked}> üîí Kh√≥a ri√™ng</label></div>
    `;

    // Li√™n k·∫øt gi√° tr·ªã realtime
    const updateDisplay = () => {
      if(ctrl.tagName==="BUTTON"||ctrl.tagName==="LABEL"||ctrl.tagName==="DIV") ctrl.textContent=ctrl.dataset.caption;
      else if(ctrl.tagName==="INPUT") ctrl.value=ctrl.dataset.caption;
      else if(ctrl.tagName==="FIELDSET") ctrl.querySelector("legend").textContent=ctrl.dataset.caption;
    };

    ["x","y","w","h"].forEach(k=>{
      document.getElementById("p_"+k).oninput=e=>{
        const v=parseInt(e.target.value)||0;
        if(k==="x")ctrl.style.left=(CENTER+v)+"px";
        if(k==="y")ctrl.style.top=(CENTER+v)+"px";
        if(k==="w")ctrl.style.width=v+"px";
        if(k==="h")ctrl.style.height=v+"px";
      };
    });

    document.getElementById("p_caption").oninput=e=>{
      ctrl.dataset.caption=e.target.value;
      updateDisplay();
    };
    document.getElementById("p_comment").oninput=e=>ctrl.dataset.comment=e.target.value;
    document.getElementById("p_part").oninput=e=>ctrl.dataset.part=e.target.value;
    document.getElementById("p_lock").onchange=e=>{
      ctrl.dataset.lock=e.target.checked?"true":"false";
      ctrl.classList.toggle("locked",e.target.checked);
    };
  }

  // üíæ JSON save/load
  const getLayout=()=>[...document.querySelectorAll(".control")].map(c=>{
    const tabs=c.classList.contains("ctrl-MenuBar")?[...c.querySelectorAll(".menu-tab")].map(t=>t.textContent):undefined;
    return{
      type:c.dataset.type,caption:c.dataset.caption,comment:c.dataset.comment,part:c.dataset.part,style:c.dataset.style,lock:c.dataset.lock,tabs,
      x:parseInt(c.style.left)-CENTER,y:parseInt(c.style.top)-CENTER,w:parseInt(c.style.width),h:parseInt(c.style.height)
    };
  });
  const setLayout=data=>{
    canvas.innerHTML='<div id="axisX" class="axis"></div><div id="axisY" class="axis"></div>';
    data.forEach(d=>addControl(d.type,d));
  };
  const saveState=()=>{undoStack.push(JSON.stringify(getLayout())); if(undoStack.length>MAX_UNDO)undoStack.shift();};

  // üì§ Export C++
  // üì§ N√∫t xu·∫•t code
  document.getElementById("exportBtn").onclick = () => {
    const type = document.getElementById("exportSelect").value;
    const layout = getLayout();
    let out = "";

    if (type === "cpp") {
      out = "// Win32 UI Builder Pro v9.9\n#include <windows.h>\n\nvoid CreateUI(HWND hwnd,HINSTANCE hInst){\n";
      out += "    HFONT hFont=(HFONT)GetStockObject(DEFAULT_GUI_FONT);\n";
      layout.forEach((c,i)=>{
        if(c.type==="MainForm")return;
        if(c.type==="MenuBar"){
          out += `\n    // Control: MenuBar | ${c.comment||""}\n    HMENU hMenu=CreateMenu();\n`;
          if(c.tabs)c.tabs.forEach(tab=>out+=`    AppendMenu(hMenu,MF_STRING,0,L"${tab}");\n`);
          out += "    SetMenu(hwnd,hMenu);\n";
        } else {
          out += `\n    // Control: ${c.type} (${c.caption}) | ${c.comment||""}\n`;
          out += `    HWND h${c.type}${i}=CreateWindowW(L"${c.type}",L"${c.caption}",${c.style},${c.x},${c.y},${c.w},${c.h},hwnd,(HMENU)${1000+i},hInst,NULL);\n`;
          out += `    SendMessage(h${c.type}${i},WM_SETFONT,(WPARAM)hFont,TRUE);\n`;
        }
      });
      out += "}\n";
    }

    else if (type === "json") {
      out = JSON.stringify(layout, null, 2);
    }

    else if (type === "ts") {
      out = "// Auto-generated TypeScript UI structure\ninterface Control {\n  type: string;\n  caption: string;\n  x: number; y: number; w: number; h: number;\n}\n\nconst layout: Control[] = " + JSON.stringify(layout, null, 2) + ";\nexport default layout;";
    }

    else if (type === "py") {
      out = "# Python tkinter UI\nimport tkinter as tk\nroot = tk.Tk()\n\n";
      layout.forEach((c,i)=>{
        if(c.type==="Button") out += `b${i} = tk.Button(root, text="${c.caption}")\nb${i}.place(x=${c.x}, y=${c.y}, width=${c.w}, height=${c.h})\n`;
        else if(c.type==="Edit") out += `e${i} = tk.Entry(root)\ne${i}.place(x=${c.x}, y=${c.y}, width=${c.w}, height=${c.h})\n`;
        else if(c.type==="Static") out += `l${i} = tk.Label(root, text="${c.caption}")\nl${i}.place(x=${c.x}, y=${c.y}, width=${c.w}, height=${c.h})\n`;
      });
      out += "\nroot.mainloop()";
    }

    // ‚úèÔ∏è Hi·ªÉn th·ªã v√† copy
    document.getElementById("outputZone").textContent = out;
    navigator.clipboard.writeText(out);
    alert(`‚úÖ ƒê√£ xu·∫•t & copy code ${type.toUpperCase()}!`);
  };


  // üíæ Save & Load JSON
  document.getElementById("saveBtn").onclick=()=>{
    const blob=new Blob([JSON.stringify(getLayout(),null,2)],{type:"application/json"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob); a.download="layout_v9.9.json"; a.click();
  };
  document.getElementById("loadBtn").onclick=()=>{
    const inp=document.createElement("input"); inp.type="file"; inp.accept=".json";
    inp.onchange=e=>{
      const f=e.target.files[0]; if(!f)return;
      const r=new FileReader();
      r.onload=ev=>{
        try{ setLayout(JSON.parse(ev.target.result)); alert("‚úÖ N·∫°p layout th√†nh c√¥ng!"); }
        catch(err){ alert("‚ùå L·ªói ƒë·ªçc layout: "+err.message); }
      };
      r.readAsText(f);
    };
    inp.click();
  };

  document.getElementById("copyOutput").onclick=()=>{
    navigator.clipboard.writeText(document.getElementById("outputZone").textContent);
    alert("‚úÖ Copied!");
  };
});
</script>

</body>
</html>
